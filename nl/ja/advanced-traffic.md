---

copyright:
  years: 2017, 2018
lastupdated: "2018-11-07"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:download: .download}
{:important: .important}
{:note: .note}

# IBM Cloud Load Balancer での高度なトラフィック管理
{: #advanced-traffic-management-with-ibm-cloud-load-balancer}

このセクションでは、ロード・バランサー・サービスで使用可能ないくつかの高度なトラフィック管理について説明します。

## 最大接続数

「最大接続数」構成を使用して、特定のフロントエンド仮想ポートに対する同時接続の最大数を制限します。 デフォルトでは、制限は指定されていません。 1 台の特定のフロントエンド仮想ポートに対する可能同時接続、または全フロントエンド仮想ポートにわたるシステム全体での可能同時接続の最大数は 15000 です。  

## セッション・パーシスタンス

ロード・バランサーは、接続の`ソース IP` に基づいて、指定された VIP ポートに対するセッション・パーシスタンスをサポートします。 例えば、ポート 80 (HTTP) でセッション・パーシスタンスが有効になっている場合、同じクライアント (同じソース IP) からの、後続の HTTP 接続試行は、同じバックエンド・サーバー上でパーシスタントになります。 この機能は、サポートされている 3 つすべてのプロトコル (HTTP、HTTPS、および TCP) で使用可能です。

ロード・バランサーは、最大 10,000 個のクライアント・パーシスタンス項目をサポートします。 これらの項目の期限切れ時間は 10 分です。 10 分より後に同じクライアントから受信した追加要求は、別のバックエンド・サーバーに転送される可能性があります。 セッション・パーシスタンス項目は期限切れしていないが、バックエンド・ポートが正常でなくなると、後続のクライアント接続を転送するための新しいサーバーが選択されます。  

## HTTP キープアライブ
クライアント・サーバーとバックエンド・サーバーの両方で有効になっている限り、ロード・バランサーは `HTTP キープアライブ`をサポートします。 ロード・バランサーはサーバー・サイドの HTTP 接続を再利用して、接続の効率性を向上させ、待ち時間を削減しようとします。

## 接続タイムアウト
ロード・バランサーによって以下のタイムアウト値が使用されます。 現時点では、これらの値はカスタマイズできません。

| 名前 | 説明 | タイムアウト |                                                                                              
| ------------------------------------------ | --------------------------------------------------- | ------------------- |
| サーバー・サイドの接続試行    | ロード・バランサーがバックエンド・サーバーとの TCP 接続を確立するために使用できる最大時間枠。 接続試行が失敗すると、ロード・バランサーは、構成されているロード・バランシング方式に従って、次に使用可能なサーバーを試行します。 | 5 秒   |
| クライアント・サイドのアイドル接続  | 最大アイドル時間。クライアントが接続を正しくクローズできなかった場合は、この時間を過ぎるとロード・バランサーはクライアント・サイド接続を停止します。| 50 秒  |
| サーバー・サイドのアイドル接続 | 最大アイドル時間 (TCP のバックエンド・プロトコル構成の場合)。この時間を過ぎると、ロード・バランサーはサーバー・サイド接続をクローズします。 HTTP のバックエンド・プロトコル構成の場合は、アイドル・タイムアウトの時間枠内に HTTP 要求への応答の受信に失敗すると、ロード・バランサーはエンド・クライアントにエラー・メッセージを返します。                                | 50 秒 |
{: caption="表 1. ロード・バランサーのタイムアウト値" caption-side="top"} 

## エンドクライアント IP アドレスの保存 

ロード・バランサーは、クライアントからの着信トラフィックを終了するリバース・プロキシーとして機能します。 ロード・バランサーは独自の IP アドレスを使用して、バックエンド・サーバー・インスタンスへの別個の接続を確立します。 (フロントエンドの HTTP 接続または HTTPS 接続に対して、) バックエンド・サーバーとの HTTP 接続の場合、ロード・バランサーは、元のクライアント IP アドレスを `X-Forwarded-For HTTP` ヘッダーに組み込んで保持します。 TCP 接続の場合、元のクライアント IP 情報は保持されません。
