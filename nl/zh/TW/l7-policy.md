---

copyright:
  years: 2017, 2018
lastupdated: "2018-11-12"

---

{:shortdesc: .shortdesc}
{:codeblock: .codeblock}
{:screen: .screen}
{:new_window: target="_blank"}
{:pre: .pre}
{:table: .aria-labeledby="caption"}

# 第 7 層原則
{: #layer-7-policy}

第 7 層 (L7) 原則用來分類資料流量，方法是比對其 L7 資訊與 L7 規則，然後在這些規則相符時採取特定動作。 

* 原則會套用至前端應用程式埠（通訊協定）。 
* 多個原則可以套用至相同的通訊協定。

因為多個原則可以套用至某個通訊協定，所以每個原則都有一個相關聯的優先順序。 

* 會先評估具有最低既定優先順序的原則。 
* 如果與原則相關聯的規則不符合資料流量，則會評估優先順序清單上的下一個最低原則。 

如果資料流量不符合任何原則規則，則資料流量會重新導向至預設儲存區，這是部署基本負載平衡器時配置的儲存區。

每個原則都會與一個動作相關聯，該動作會在原則中的所有規則都符合資料流量時執行。

動作可以是：

- 拒絕 
- 重新導向至 URL
- 重新導向至儲存區 

不論其優先順序為何，都會先評估設為 `reject` 的原則。

之後，會評估設為 `redirect to url` 的原則。

最後，評估設為 `redirect to pool` 的原則。

在每個動作種類內，會依遞增的優先順序來評估原則（最低到最高）。

## 第 7 層原則內容

內容      |說明 
------------- | -------------
名稱 | 原則的名稱。每個原則都必須具有唯一名稱。
動作 | 在規則相符時要採取的動作。動作為 `REJECT`、`REDIRECT_URL` 及 `REDIRECT_POOL`。不論其優先順序為何，一律都會先評估其動作設為 `REJECT` 的原則。接著評估其動作設為 `REDIRECT_URL` 的原則，後面再評估其動作設為 `REDIRECT_POOL` 的原則。
優先順序 | 根據遞增的優先順序來評估原則。
重新導向 URL | 將重新導向資料流量的 URL（如果動作設為 `REDIRECT_URL`）。
重新導向 L7 儲存區 | 將傳送資料流量的伺服器儲存區（如果動作設為 `REDIRECT_POOL`）。
通訊協定 | 套用原則的前端應用程式埠。

## 第 7 層規則
第 7 層規則定義要與特定值比對的送入資料流量部分。

* 如果送入的資料流量符合指定的規則值，則規則會評估為 `true`。
* 第 7 層規則一律與第 7 層原則相關聯。多個第 7 層規則可以與相同的第 7 層原則相關聯。
* 如果多個規則與某個原則相關聯，則每個規則都會評估為 `true` 或 `false`。 
* 如果與原則相關聯的所有規則都評估為 `true`，則會將原則動作套用至該要求。否則，負載平衡器會評估下一個原則。

規則的類型可以是： 

* `HOST_NAME`
* `FILE_TYPE`
* `HEADER`
* `COOKIE`
* `PATH`

這些指出要與規則比對的第 7 層資料流量部分。

類型      | 要擷取及評估的欄位
----------| -----------------------
`HOST_NAME` |URL 的主機名稱部分（例如 `api.my_company.com`）
`FILE_TYPE` |URL 的結尾，代表檔案類型（例如 `jpg`）
HEADER    | HTTP 標頭中的欄位
COOKIE    | HTTP 標頭中的具名 Cookie
PATH      |主機名稱後面的 URL 部分（例如 `/index.html`）

規則也具有比較類型，可指出其評估方式。規則可具有下列比較類型： 

* `REGEX`
* `STARTS_WITH`
* `ENDS_WITH`
* `CONTAINS`
* `EQUAL_TO`

比較類型        |  評估類型
----------------|---------------------
`REGEX`           |比對擷取的欄位（例如 `hostname`）與提供的正規表示式
`STARTS_WITH`     |  驗證擷取的欄位是否以提供的字串為開頭
`ENDS_WITH`       |  驗證擷取的欄位是否以提供的字串為結尾
`CONTAINS`        |  驗證擷取的欄位是否包含提供的字串
`EQUAL_TO`        |  驗證擷取的欄位是否與提供的字串相同

**附註**：並非所有規則類型都支援所有比較類型。例如，如果您使用 `FILE_TYPE`，則最好使用比較類型 `REGEX` 及 `ENDS_WITH`。

## 第 7 層規則內容

內容      |說明 
------------- | -------------
類型 | 指定規則的類型。規則類型可以是 `HOST_NAME`（主機名稱）、`FILE_TYPE`（檔案類型）、`HEADER`（標頭）、`COOKIE`（Cookie）或 `PATH`（路徑）。
比較類型        | 比較類型用於與規則類型、索引鍵及值相關聯，以定義規則及分類資料流量。比較類型可以是：`REGEX`、`STARTS_WITH`、`ENDS_WITH`、`CONTAINS` 及 `EQUAL_TO`。
索引鍵 | 規則類型 `HEADER` 及 `COOKIE` 的說明索引鍵。
值 | 對於規則類型 `HEADER` 及 `COOKIE`，值會與索引鍵進行比較。
反轉 | 如果您將值設為 1，則只要指定的規則不相符時，就會將此 L7 規則比較的值設為 `true`。
第 7 層原則 ID | 附加規則之原則的唯一 ID。
