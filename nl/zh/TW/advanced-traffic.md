---

copyright:
  years: 2017, 2018
lastupdated: "2018-11-07"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:codeblock: .codeblock}
{:pre: .pre}
{:screen: .screen}
{:tip: .tip}
{:download: .download}
{:important: .important}
{:note: .note}

# 使用 IBM Cloud Load Balancer 進行進階資料流量管理
{: #advanced-traffic-management-with-ibm-cloud-load-balancer}

本節討論負載平衡器服務所提供的數個進階資料流量管理特性。

## 連線上限

使用「連線上限」配置，可限制給定前端虛擬埠的並行連線數目上限。依預設，不會指定任何限制。給定前端虛擬埠的可能並行連線上限或所有前端虛擬埠的系統層面並行連線上限是 15000。  

## 階段作業持續性

負載平衡器會根據連線的`來源 IP` 來支援給定 VIP 埠的階段作業持續性。舉例來說，如果啟用埠 80 (HTTP) 的階段作業持續性，則來自相同用戶端（相同來源 IP）的後續 HTTP 連線嘗試會持續保留在相同的後端伺服器上。此特性適用於全部三個支援的通訊協定（HTTP、HTTPS 及 TCP）。

負載平衡器支援最多 10,000 個用戶端持續性項目。這些項目的有效期限是 10 分鐘。10 分鐘後接收自相同用戶端的其他要求可能會轉遞至不同的後端伺服器。如果階段作業持續性項目未過期，但後端埠的性能不佳，則會選取新伺服器來轉遞任何後續的用戶端連線。  

## HTTP 保留作用中
只要同時在用戶端及後端伺服器上啟用負載平衡器，負載平衡器就會支援 `HTTP 保留作用中`。負載平衡器會試圖重複使用伺服器端 HTTP 連線，以增加連線效率並減少延遲。

## 連線逾時值
負載平衡器會使用下列逾時值。目前無法自訂這些值。

|名稱 |說明 |逾時值 |                                                                                              
| ------------------------------------------ | --------------------------------------------------- | ------------------- |
|伺服器端連線嘗試    |負載平衡器可用來建立與後端伺服器的 TCP 連線的最大時間範圍。如果連線嘗試未順利完成，則負載平衡器會根據您已配置的負載平衡方法來嘗試下一個可用的伺服器。|5 秒   |
|用戶端閒置連線  |閒置時間上限，如果用戶端無法適當地關閉其連線，則負載平衡器會在此時間之後結束用戶端連線。|50 秒  |
|伺服器端閒置連線 |閒置時間上限（後端通訊協定配置為 TCP），負載平衡器會在此時間之後關閉伺服器端連線。後端通訊協定配置為 HTTP 時，如果負載平衡器在閒置逾時時間範圍內收不到其 HTTP 要求的回應，則會將錯誤訊息傳回給後端用戶端。|50 秒 |
{: caption="表 1. 負載平衡器逾時值" caption-side="top"} 

## 保留後端用戶端 IP 位址 

負載平衡器是作為反向 Proxy，可終止從用戶端送入的資料流量。它會使用自己的 IP 位址來建立與後端伺服器實例的個別連線。對於與後端伺服器的 HTTP 連線（相對於前端 HTTP 或 HTTPS 連線），負載平衡器會保留原始用戶端 IP 位址，方法是將它併入 `X-Forwarded-For HTTP` 標頭內。對於 TCP 連線，則不保留原始用戶端 IP 資訊。
